<!DOCTYPE html><html lang="vi">
<head>
  <meta charset="utf-8">
  <title>Bản đồ nhân viên</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.10.2/dist/leaflet.css"/>
  <style>html,body,#map{height:100%;margin:0}</style>
</head>
<body>
<div id="map"></div>
<script src="https://unpkg.com/leaflet@1.10.2/dist/leaflet.js"></script>
<script>
const URL='https://script.google.com/macros/s/AKfycbyQtOhGWKhT6gEUAlBVfV9iKjqmtHXNaR_2XmkD1XSCOiuNbh6A5ulkq6PxUBWsZpbBgg/exec';

const map=L.map('map').setView([16,106],6);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
  {attribution:'© OpenStreetMap'}).addTo(map);

async function reload(){
   const r=await fetch(URL+'?action=getPositions');
   const j=await r.json(); if(j.status!=='ok') return;
   map.eachLayer(l=>l.options && l.options.pane==='markerPane' && map.removeLayer(l));
   const b=[];
   j.positions.forEach(p=>{
      L.marker([p.lat,p.lng]).addTo(map)
         .bindTooltip(`${p.name}<br>${p.unit}<br>${new Date(p.time).toLocaleTimeString()}`);
      b.push([p.lat,p.lng]);
   });
   if(b.length) map.fitBounds(b,{padding:[12,12]});
}
reload(); setInterval(reload,15000);
</script>
</body></html>
